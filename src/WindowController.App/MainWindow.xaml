<ui:FluentWindow x:Class="WindowController.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        mc:Ignorable="d"
        Title="Window-Controller" Height="800" Width="1140"
        WindowStartupLocation="CenterScreen"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica"
        Closing="Window_Closing">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ═══════════════ TitleBar ═══════════════ -->
        <ui:TitleBar Grid.Row="0" Title="Window-Controller" ShowMaximize="True" ShowMinimize="True"/>

        <!-- ═══════════════ Main Content ═══════════════ -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel Margin="24,0,24,16">

                <!-- ═══════ Section 1 : Running Windows ═══════ -->
                <TextBlock Text="起動中ウィンドウ" Style="{StaticResource SectionHeader}"/>
                <TextBlock Text="チェックしたウィンドウをプロファイルに保存できます" Style="{StaticResource SectionDescription}"/>

                <Border Style="{StaticResource SectionCard}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Refresh button -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                            <ui:Button Appearance="Info" Command="{Binding RefreshWindowsCommand}" Margin="0,0,12,0"
                                       Background="#0280b5" BorderBrush="#0280b5">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="ArrowSync24" />
                                </ui:Button.Icon>
                                <ui:Button.Content>
                                    <TextBlock Text="更新"/>
                                </ui:Button.Content>
                            </ui:Button>
                        </StackPanel>

                        <!-- Window DataGrid -->
                        <DataGrid Grid.Row="1"
                                  x:Name="dgWindows"
                                  ItemsSource="{Binding Windows}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="False"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow"
                                  HeadersVisibility="Column"
                                  GridLinesVisibility="None"
                                  MaxHeight="260"
                                  BorderThickness="0"
                                  Background="Transparent"
                                  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                  RowHeight="32"
                                  RowStyle="{StaticResource RoundedRow}"
                                  CellStyle="{StaticResource TransparentCell}"
                                  PreviewMouseWheel="DataGrid_PreviewMouseWheel"
                                  Margin="0,0,0,10">
                            <DataGrid.Columns>
                                <DataGridTemplateColumn Header="" Width="40" MinWidth="40">
                                    <DataGridTemplateColumn.CellStyle>
                                        <Style TargetType="DataGridCell">
                                            <Setter Property="Padding" Value="2,0,0,0"/>
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="BorderBrush" Value="Transparent"/>
                                            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                                            <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                                        </Style>
                                    </DataGridTemplateColumn.CellStyle>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <CheckBox IsChecked="{Binding IsChecked, UpdateSourceTrigger=PropertyChanged}"
                                                      Style="{StaticResource AccentCheckBox}"
                                                      HorizontalAlignment="Left" VerticalAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="*" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Exe" Binding="{Binding Exe}" Width="120" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Class" Binding="{Binding Class}" Width="130" IsReadOnly="True"/>
                                <DataGridTextColumn Header="URL" Binding="{Binding Url}" Width="200" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Profile" Binding="{Binding BrowserProfile}" Width="100" IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Save profile bar -->
                        <Grid Grid.Row="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*" MaxWidth="320"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="プロファイル名" VerticalAlignment="Center"
                                       FontSize="13" Margin="0,0,12,0"/>
                            <ui:TextBox Grid.Column="1" x:Name="txtProfileName"
                                        PlaceholderText="名前を入力…"
                                        Text="{Binding ProfileName, UpdateSourceTrigger=PropertyChanged}"
                                        Margin="0,0,12,0"/>
                            <ui:Button Grid.Column="2" Appearance="Success" Command="{Binding SaveProfileCommand}"
                                       Background="#3c8840" BorderBrush="#3c8840">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="Save24" />
                                </ui:Button.Icon>
                                <ui:Button.Content>
                                    <TextBlock Text="プロファイル保存"/>
                                </ui:Button.Content>
                            </ui:Button>
                        </Grid>
                    </Grid>
                </Border>

                <!-- ═══════ Section 2 : Saved Profiles ═══════ -->
                <TextBlock Text="保存済みプロファイル" Style="{StaticResource SectionHeader}"/>
                <TextBlock Text="チェック＝最小化 / 最大化を常時連動" Style="{StaticResource SectionDescription}"/>

                <Border Style="{StaticResource SectionCard}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Profile DataGrid -->
                        <DataGrid Grid.Row="0"
                                  x:Name="dgProfiles"
                                  ItemsSource="{Binding Profiles}"
                                  SelectedItem="{Binding SelectedProfile}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="False"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow"
                                  HeadersVisibility="Column"
                                  GridLinesVisibility="None"
                                  MaxHeight="180"
                                  BorderThickness="0"
                                  Background="Transparent"
                                  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                  RowHeight="32"
                                  RowStyle="{StaticResource RoundedRow}"
                                  CellStyle="{StaticResource TransparentCell}"
                                  PreviewMouseWheel="DataGrid_PreviewMouseWheel"
                                  Margin="0,0,0,10">
                            <DataGrid.Columns>
                                <DataGridTemplateColumn Header="連動" Width="60" MinWidth="60">
                                    <DataGridTemplateColumn.CellStyle>
                                        <Style TargetType="DataGridCell">
                                            <Setter Property="Padding" Value="2,0,0,0"/>
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="BorderBrush" Value="Transparent"/>
                                            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                                            <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                                        </Style>
                                    </DataGridTemplateColumn.CellStyle>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <CheckBox IsChecked="{Binding SyncMinMax, UpdateSourceTrigger=PropertyChanged}"
                                                      Style="{StaticResource AccentCheckBox}"
                                                      HorizontalAlignment="Left" VerticalAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Profile" Binding="{Binding Name, UpdateSourceTrigger=LostFocus}" Width="*"/>
                                <DataGridTextColumn Header="Windows" Binding="{Binding WindowCount}" Width="80" IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Action buttons -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal">
                            <ui:Button Appearance="Info" Command="{Binding ApplyProfileCommand}" Margin="0,0,8,0"
                                       Background="#0280b5" BorderBrush="#0280b5">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="Checkmark24" />
                                </ui:Button.Icon>
                                <ui:Button.Content>
                                    <TextBlock Text="適用（配置のみ）"/>
                                </ui:Button.Content>
                            </ui:Button>
                            <ui:Button Appearance="Info" Command="{Binding LaunchAndApplyProfileCommand}" Margin="0,0,8,0"
                                       Background="#0280b5" BorderBrush="#0280b5">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="Rocket24" />
                                </ui:Button.Icon>
                                <ui:Button.Content>
                                    <TextBlock Text="一括起動＋配置"/>
                                </ui:Button.Content>
                            </ui:Button>
                            <ui:Button Appearance="Danger" Command="{Binding DeleteProfileCommand}"
                                       Background="#b8180c" BorderBrush="#b8180c">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="Delete24" />
                                </ui:Button.Icon>
                                <ui:Button.Content>
                                    <TextBlock Text="削除"/>
                                </ui:Button.Content>
                            </ui:Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- ═══════ Section 3 : Settings ═══════ -->
                <TextBlock Text="設定" Style="{StaticResource SectionHeader}"/>

                <Border Style="{StaticResource SectionCard}">
                    <StackPanel>
                        <!-- Sync toggle row -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                <TextBlock Text="連動機能を有効にする" FontSize="14"/>
                                <TextBlock Text="最小化 / 最大化の連動を全体で有効にします"
                                           Style="{StaticResource SettingDescription}"/>
                            </StackPanel>
                            <CheckBox Grid.Column="1" IsChecked="{Binding SyncEnabled}" VerticalAlignment="Center"
                                      Style="{StaticResource AccentCheckBox}"/>
                        </Grid>

                        <Separator Margin="0,0,0,10" Opacity="0.3"/>

                        <!-- Show GUI on startup row -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                <TextBlock Text="起動時にGUIを表示する" FontSize="14"/>
                                <TextBlock Text="OFFの場合はタスクトレイ常駐のみ"
                                           Style="{StaticResource SettingDescription}"/>
                            </StackPanel>
                            <CheckBox Grid.Column="1" IsChecked="{Binding ShowGuiOnStartup}" VerticalAlignment="Center"
                                      Style="{StaticResource AccentCheckBox}"/>
                        </Grid>

                        <Separator Margin="0,0,0,10" Opacity="0.3"/>

                        <!-- Profiles path row -->
                        <StackPanel>
                            <TextBlock Text="プロファイルの保存先" FontSize="14" Margin="0,0,0,8"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ui:TextBox Grid.Column="0"
                                            Text="{Binding ProfilesPathDisplay, Mode=OneWay}"
                                            IsReadOnly="True"
                                            PlaceholderText="保存先パス"
                                            ToolTip="{Binding ProfilesPathDisplay}"
                                            Margin="0,0,8,0"/>
                                <ui:Button Grid.Column="1" Appearance="Secondary" Command="{Binding BrowseProfilesPathCommand}" Margin="0,0,8,0">
                                    <ui:Button.Icon>
                                        <ui:SymbolIcon Symbol="FolderOpen24" />
                                    </ui:Button.Icon>
                                    <ui:Button.Content>
                                        <TextBlock Text="変更…"/>
                                    </ui:Button.Content>
                                </ui:Button>
                                <ui:Button Grid.Column="2" Appearance="Secondary" Command="{Binding ResetProfilesPathCommand}">
                                    <ui:Button.Icon>
                                        <ui:SymbolIcon Symbol="ArrowCounterclockwise24" />
                                    </ui:Button.Icon>
                                    <ui:Button.Content>
                                        <TextBlock Text="既定に戻す"/>
                                    </ui:Button.Content>
                                </ui:Button>
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- ═══════════════ Status Bar ═══════════════ -->
        <Border Grid.Row="2" Padding="24,6"
                Background="{DynamicResource ControlFillColorDefaultBrush}"
                BorderThickness="0,1,0,0"
                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}">
            <TextBlock Text="{Binding StatusText}" FontSize="12" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
        </Border>
    </Grid>
</ui:FluentWindow>
